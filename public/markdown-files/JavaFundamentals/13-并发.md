# å¹¶å‘

#### 1. å¹¶å‘æ¦‚è¿°

ç³»ç»Ÿå…·æœ‰`å¤„ç†å¤šä¸ªä»»åŠ¡`çš„èƒ½åŠ›

- è¿›ç¨‹å’Œçº¿ç¨‹
  - è¿›ç¨‹ Process
    - æ¯ä¸€ä¸ªç‹¬ç«‹æ‰§è¡Œç¨‹åº
    - è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…ã€è°ƒåº¦ç®¡ç†çš„`æœ€å°å•ä½`
    - æ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰`ç‹¬ç«‹å†…å­˜å•å…ƒ`
  - çº¿ç¨‹ Thread
    - çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­/ç¨‹åºå†…éƒ¨çš„ä¸€æ¡æ‰§è¡Œæµç¨‹
    - ä¸€ä¸ªè¿›ç¨‹ä¸­å…è®¸å¤šä¸ªçº¿ç¨‹ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ç§°ä½œ`ä¸»çº¿ç¨‹`
    - ä¸€ä¸ªè¿›ç¨‹ä¸­å¤šä¸ªçº¿ç¨‹`å…±äº«å†…å­˜å•å…ƒ`
- å¤šçº¿ç¨‹ï¼šè¿›ç¨‹ä¸­å­˜åœ¨`å¤šä¸ªçº¿ç¨‹`ï¼Œçº¿ç¨‹åˆ†åˆ«`æŠ¢å CPU`æ¥æ‰§è¡Œ
- å¼‚æ­¥ Future
  - å¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€ç§å…è®¸ä»»åŠ¡åœ¨åå°å‘èµ·çš„æ‰§è¡Œæ¨¡å¼ï¼Œè€Œæ— éœ€ç­‰å¾…å…¶å®Œæˆå³å¯ç»§ç»­æ‰§è¡Œåç»­ä»£ç 



#### 2. åˆ›å»ºå’Œå¯åŠ¨

##### 2.1 è¿›ç¨‹

- ä½¿ç”¨`ProcessBuilder` (æ¨è)

  ```java
  import java.io.IOException;
  
  public class ProcessCreation {
      public static void main(String[] args) {
          // 1. ä½¿ç”¨ ProcessBuilder (æ¨è)
          ProcessBuilder processBuilder = new ProcessBuilder("notepad.exe");
          // å¯ä»¥è®¾ç½®å·¥ä½œç›®å½•ã€ç¯å¢ƒå˜é‡ç­‰
          // processBuilder.directory(new File("C:\\MyDir"));
          
          try {
              Process process = processBuilder.start(); // å¯åŠ¨å¤–éƒ¨è¿›ç¨‹
              System.out.println("è¿›ç¨‹å·²å¯åŠ¨ï¼ŒPID: " + process.pid());
              
              // ç­‰å¾…è¿›ç¨‹ç»“æŸï¼ˆå½“å‰çº¿ç¨‹ä¼šé˜»å¡ï¼‰
              int exitCode = process.waitFor();
              System.out.println("è¿›ç¨‹ç»“æŸï¼Œé€€å‡ºç : " + exitCode);
              
          } catch (IOException | InterruptedException e) {
              e.printStackTrace();
          }
      }
  }

- ä½¿ç”¨ `Runtime.exec() `(æ—§æ–¹å¼ï¼Œä¸æ¨è)

  ```java
  import java.io.IOException;
  
  public class ProcessCreation {
      public static void main(String[] args) {
          // 2. ä½¿ç”¨ Runtime.exec() (æ—§æ–¹å¼ï¼Œä¸æ¨è)
          try {
              Process process = Runtime.getRuntime().exec("calc.exe");
              // ... åŒæ ·å¯ä»¥ç”¨ waitFor() ç­‰å¾…
          } catch (IOException e) {
              e.printStackTrace();
          }
      }
  }
  ```

##### 2.2 çº¿ç¨‹

- ç»§æ‰¿`Thread`ç±»

  ```java
  public class ThreadCreation {
      public static void main(String[] args) {
          // æ–¹å¼ä¸€ï¼šç»§æ‰¿ Thread ç±»
          class MyThread extends Thread {
              @Override
              public void run() {
                  System.out.println("çº¿ç¨‹è¿è¡Œä¸­: " + Thread.currentThread().getName());
              }
          }
          MyThread thread1 = new MyThread();
          thread1.start(); // å¿…é¡»è°ƒç”¨ start()ï¼Œè€Œä¸æ˜¯ run()
  
          // æ–¹å¼äºŒï¼šå®ç° Runnable æ¥å£ (æ›´å¸¸ç”¨ï¼Œæ›´çµæ´»)
          Runnable task = new Runnable() {
              @Override
              public void run() {
                  System.out.println("Runnableçº¿ç¨‹: " + Thread.currentThread().getName());
              }
          };
          Thread thread2 = new Thread(task);
          thread2.start();
  
          // æ–¹å¼ä¸‰ï¼šä½¿ç”¨ Lambda è¡¨è¾¾å¼ (Java 8+ï¼Œæœ€ç®€æ´)
          Thread thread3 = new Thread(() -> {
              System.out.println("Lambdaçº¿ç¨‹: " + Thread.currentThread().getName());
          });
          thread3.start();
      }
  }
  ```

- å®ç° `Runnable` æ¥å£

  ```java
  public class ThreadCreation {
      public static void main(String[] args) {
          // æ–¹å¼äºŒï¼šå®ç° Runnable æ¥å£ (æ›´å¸¸ç”¨ï¼Œæ›´çµæ´»)
          Runnable task = new Runnable() {
              @Override
              public void run() {
                  System.out.println("Runnableçº¿ç¨‹: " + Thread.currentThread().getName());
              }
          };
          Thread thread2 = new Thread(task);
          thread2.start();
  
          // æ–¹å¼ä¸‰ï¼šä½¿ç”¨ Lambda è¡¨è¾¾å¼ (Java 8+ï¼Œæœ€ç®€æ´)
          Thread thread3 = new Thread(() -> {
              System.out.println("Lambdaçº¿ç¨‹: " + Thread.currentThread().getName());
          });
          thread3.start();
      }
  }
  ```

- `çº¿ç¨‹æ± `åˆ›å»º

  ```java
  public class ThreadCreation {
      public static void main(String[] args) { 
          // æ–¹å¼å››ï¼šä½¿ç”¨çº¿ç¨‹æ±  (ç”Ÿäº§ç¯å¢ƒé¦–é€‰)
          // åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± 
          java.util.concurrent.ExecutorService executor = java.util.concurrent.Executors.newFixedThreadPool(4);
          
          // æäº¤ä»»åŠ¡ç»™çº¿ç¨‹æ± æ‰§è¡Œ
          for (int i = 0; i < 10; i++) {
              final int taskId = i;
              executor.submit(() -> {
                  System.out.println("ä»»åŠ¡ " + taskId + " ç”±çº¿ç¨‹æ± æ‰§è¡Œ: " + Thread.currentThread().getName());
              });
          }
          
          // å…³é—­çº¿ç¨‹æ± ï¼ˆä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œç­‰å¾…å·²æäº¤ä»»åŠ¡å®Œæˆï¼‰
          executor.shutdown();
      }
  }
  ```

##### 2.3 å¼‚æ­¥

- ä½¿ç”¨ `CompletableFuture` (ç°ä»£é¦–é€‰ï¼ŒJava 8+)

  ```java
  import java.util.concurrent.CompletableFuture;
  import java.util.concurrent.Executors;
  
  public class SimpleAsync {
      public static void main(String[] args) throws Exception {
          // åŸºæœ¬å¼‚æ­¥ä»»åŠ¡
          CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {
              sleep(1000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
              return "ä»»åŠ¡å®Œæˆï¼";
          });
          
          System.out.println("ä¸»çº¿ç¨‹ç»§ç»­å·¥ä½œ...");
          
          // è·å–ç»“æœï¼ˆä¼šé˜»å¡ç­‰å¾…ï¼‰
          String result = future.get();
          System.out.println(result);
          
          // é“¾å¼å¤„ç†ç¤ºä¾‹
          CompletableFuture.supplyAsync(() -> "hello")
              .thenApply(s -> s + " world")
              .thenAccept(System.out::println); // è¾“å‡º: hello world
      }
      
      private static void sleep(long ms) {
          try { Thread.sleep(ms); } catch (InterruptedException e) {}
      }
  }
  ```

- ä½¿ç”¨ `Future` + `ExecutorService` (ä¼ ç»Ÿæ–¹å¼)

  ```java
  import java.util.concurrent.*;
  
  public class SimpleFuture {
      public static void main(String[] args) throws Exception {
          ExecutorService executor = Executors.newSingleThreadExecutor();
          
          Future<String> future = executor.submit(() -> {
              sleep(2000);
              return "Futureä»»åŠ¡ç»“æœ";
          });
          
          System.out.println("ä»»åŠ¡å·²æäº¤ï¼Œç»§ç»­å¤„ç†å…¶ä»–äº‹æƒ…...");
          
          // ç­‰å¾…å¹¶è·å–ç»“æœ
          String result = future.get();
          System.out.println("æ”¶åˆ°ç»“æœ: " + result);
          
          executor.shutdown();
      }
      
      private static void sleep(long ms) {
          try { Thread.sleep(ms); } catch (InterruptedException e) {}
      }
  }
  ```

- ä½¿ç”¨`è™šæ‹Ÿçº¿ç¨‹`

  ```java
  // éœ€è¦ --enable-preview (Java 19/20) æˆ– Java 21+
  public class VirtualThreadDemo {
      public static void main(String[] args) {
          // è¯­æ³•ä¸ä¼ ç»Ÿçº¿ç¨‹å‡ ä¹ä¸€è‡´ï¼Œä½†èƒŒåæ˜¯é«˜æ•ˆçš„å¼‚æ­¥è°ƒåº¦
          // 1. ç›´æ¥å¯åŠ¨
          Thread.startVirtualThread(() -> {
              System.out.println("è¿è¡Œåœ¨è™šæ‹Ÿçº¿ç¨‹: " + Thread.currentThread());
          });
  
          // 2. ä½¿ç”¨ Builder åˆ›å»º
          Thread vt = Thread.ofVirtual().name("my-vt-").start(() -> {
              System.out.println("å¸¦åå­—çš„è™šæ‹Ÿçº¿ç¨‹: " + Thread.currentThread().getName());
          });
  
          // 3. ä½¿ç”¨ Executors åˆ›å»º (æ¨è)
          try (var executor = Executors.newVirtualThreadPerTaskExecutor()) {
              for (int i = 0; i < 10_000; i++) { // è½»æ¾åˆ›å»ºå¤§é‡è™šæ‹Ÿçº¿ç¨‹
                  executor.submit(() -> {
                      Thread.sleep(Duration.ofSeconds(1));
                      System.out.println("Task executed: " + Thread.currentThread());
                      return null;
                  });
              }
          } // executor.close() ä¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
          System.out.println("æ‰€æœ‰è™šæ‹Ÿçº¿ç¨‹ä»»åŠ¡å·²å®Œæˆ");
      }
  }
  ```

#### 3. çº¿ç¨‹é€šä¿¡

çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å°†æ•°æ®ä¼ é€’ç»™å¦å¤–ä¸€ä¸ªçº¿ç¨‹

##### 3.1 å®ç°

- å®ç°`Callable`ï¼Œ`FutureTask`

  Callå›è°ƒï¼ŒCallableæ‰§è¡Œå®Œæ¯•ï¼Œå¤–ç•Œè·å¾—å›è°ƒè¿”å›å€¼
  
  - ä¼˜ç‚¹ï¼šå¯ä»¥é€šè¿‡å›è°ƒè·å–çº¿ç¨‹æ‰§è¡Œç»“æœ
  - ç¼ºç‚¹ï¼šé€ æˆçº¿ç¨‹é˜»å¡

  ```java
  import java.util.concurrent.*;
  
  public class CallableExample {
      public static void main(String[] args) throws Exception {
          // åˆ›å»º Callable ä»»åŠ¡
          Callable<String> task = new Callable<String>() {
              @Override
              public String call() throws Exception {
                  Thread.sleep(2000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
                  return "ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œè¿”å›ç»“æœ";
              }
          };
          
          // ä½¿ç”¨ FutureTask åŒ…è£… Callable
          FutureTask<String> futureTask = new FutureTask<>(task);
          
          // å¯åŠ¨çº¿ç¨‹æ‰§è¡Œä»»åŠ¡
          Thread thread = new Thread(futureTask);
          thread.start();
          
          System.out.println("ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œå…¶ä»–å·¥ä½œ...");
          
          // è·å–æ‰§è¡Œç»“æœï¼ˆä¼šé˜»å¡ç­‰å¾…ï¼‰
          String result = futureTask.get();
          System.out.println("æ”¶åˆ°çº¿ç¨‹æ‰§è¡Œç»“æœ: " + result);
      }
  }
  ```

- å¼‚æ­¥å›è°ƒ

  - å›è°ƒæ¥å£å®ç°

    ```java
    // å®šä¹‰å›è°ƒæ¥å£
    interface TaskCallback {
        void onSuccess(String result);
        void onError(Exception error);
    }
    
    public class CallbackExample {
        public static void main(String[] args) {
            // ä½¿ç”¨å›è°ƒæ¥å£
            executeTaskAsync("å¤„ç†æ•°æ®", new TaskCallback() {
                @Override
                public void onSuccess(String result) {
                    System.out.println("ä»»åŠ¡æˆåŠŸ: " + result);
                }
                
                @Override
                public void onError(Exception error) {
                    System.out.println("ä»»åŠ¡å¤±è´¥: " + error.getMessage());
                }
            });
            
            System.out.println("ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ...");
            
            // é˜²æ­¢ä¸»çº¿ç¨‹è¿‡æ—©ç»“æŸ
            try { Thread.sleep(3000); } catch (InterruptedException e) {}
        }
        
        // å¼‚æ­¥æ‰§è¡Œä»»åŠ¡çš„æ–¹æ³•
        public static void executeTaskAsync(String taskName, TaskCallback callback) {
            new Thread(() -> {
                try {
                    Thread.sleep(2000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
                    String result = taskName + " æ‰§è¡Œå®Œæˆ";
                    callback.onSuccess(result);
                } catch (Exception e) {
                    callback.onError(e);
                }
            }).start();
        }
    }
    ```

  - Lambdaè¡¨è¾¾å¼

    ```java
    public class LambdaCallbackExample {
        public static void main(String[] args) {
            // ä½¿ç”¨ Lambda è¡¨è¾¾å¼ç®€åŒ–å›è°ƒ
            executeTaskAsync("æ•°æ®å¤„ç†ä»»åŠ¡", 
                result -> System.out.println("æˆåŠŸ: " + result),
                error -> System.out.println("å¤±è´¥: " + error.getMessage())
            );
            
            System.out.println("ä¸»çº¿ç¨‹ç»§ç»­å·¥ä½œ...");
            
            // é˜²æ­¢ä¸»çº¿ç¨‹è¿‡æ—©ç»“æŸ
            try { Thread.sleep(3000); } catch (InterruptedException e) {}
        }
        
        // æ”¯æŒ Lambda çš„å¼‚æ­¥æ–¹æ³•
        public static void executeTaskAsync(String taskName, 
                                          java.util.function.Consumer<String> onSuccess,
                                          java.util.function.Consumer<Exception> onError) {
            new Thread(() -> {
                try {
                    Thread.sleep(2000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
                    String result = taskName + " å®Œæˆ";
                    onSuccess.accept(result);
                } catch (Exception e) {
                    onError.accept(e);
                }
            }).start();
        }
    }
    ```
> **å›è°ƒåœ°ç‹± (Callback Hell)**
>
> å›è°ƒåœ°ç‹±æ˜¯æŒ‡åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œå½“éœ€è¦æ‰§è¡Œå¤šä¸ªè¿ç»­çš„å¼‚æ­¥æ“ä½œæ—¶ï¼Œå›è°ƒå‡½æ•°å±‚å±‚åµŒå¥—ï¼Œå½¢æˆæ·±åº¦åµŒå¥—çš„ä»£ç ç»“æ„ï¼Œä½¿ä»£ç éš¾ä»¥é˜…è¯»ã€ç†è§£å’Œç»´æŠ¤ã€‚
>
> **å…¸å‹çš„å›è°ƒåœ°ç‹±ç¤ºä¾‹ï¼š**
> ```java
> // æ¨¡æ‹Ÿå¤šä¸ªå¼‚æ­¥æ“ä½œçš„åµŒå¥—
> executeTaskAsync("ä»»åŠ¡1", 
>     result1 -> {
>         System.out.println("ä»»åŠ¡1å®Œæˆ: " + result1);
>         executeTaskAsync("ä»»åŠ¡2", 
>             result2 -> {
>                 System.out.println("ä»»åŠ¡2å®Œæˆ: " + result2);
>                 executeTaskAsync("ä»»åŠ¡3", 
>                     result3 -> {
>                         System.out.println("ä»»åŠ¡3å®Œæˆ: " + result3);
>                     },
>                     error3 -> System.out.println("ä»»åŠ¡3å¤±è´¥: " + error3.getMessage())
>                 );
>             },
>             error2 -> System.out.println("ä»»åŠ¡2å¤±è´¥: " + error2.getMessage())
>         );
>     },
>     error1 -> System.out.println("ä»»åŠ¡1å¤±è´¥: " + error1.getMessage())
>    );
>    ```
>    
>    **å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼š**
>    - ä»£ç å¯è¯»æ€§å·®ï¼Œéš¾ä»¥ç†è§£æ‰§è¡Œæµç¨‹
>    - é”™è¯¯å¤„ç†å¤æ‚ï¼Œæ¯å±‚éƒ½éœ€è¦å¤„ç†å¼‚å¸¸
> - ä»£ç ç»´æŠ¤å›°éš¾ï¼Œä¿®æ”¹é€»è¾‘éœ€è¦åœ¨å¤šå±‚åµŒå¥—ä¸­æ“ä½œ
> - è°ƒè¯•å›°éš¾ï¼Œå †æ ˆè·Ÿè¸ªå¤æ‚
>
> **è§£å†³å›è°ƒåœ°ç‹±çš„æ–¹æ³•ï¼ˆå‚è€ƒå¼‚æ­¥åˆ›å»ºï¼‰ï¼š**
> 
> - ä½¿ç”¨ CompletableFuture é“¾å¼è°ƒç”¨
> 
> - ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹ (Java 21+)

#### 4. åŸºæœ¬æ–¹æ³•

- **çº¿ç¨‹åç§°**ï¼š`thread.getName()`
  - ä¸»çº¿ç¨‹ï¼šmain
  - å­çº¿ç¨‹ï¼šthread-xx
- **å‘½åçº¿ç¨‹**ï¼š`thread.setName(String str)`
- **è·å–å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹**ï¼š`Thread.getCurrentThread()`

```java
public class ThreadBasicMethods {
    public static void main(String[] args) {
        // è·å–å½“å‰çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰
        Thread mainThread = Thread.currentThread();
        System.out.println("ä¸»çº¿ç¨‹åç§°: " + mainThread.getName());
        
        // åˆ›å»ºå­çº¿ç¨‹
        Thread childThread = new Thread(() -> {
            Thread current = Thread.currentThread();
            System.out.println("å­çº¿ç¨‹é»˜è®¤åç§°: " + current.getName());
        });
        
        // è®¾ç½®çº¿ç¨‹åç§°
        childThread.setName("MyWorkerThread");
        childThread.start();
        
        // å†æ¬¡è·å–åç§°
        System.out.println("å­çº¿ç¨‹è®¾ç½®ååç§°: " + childThread.getName());
    }
}
```

#### 5. ç”Ÿå‘½å‘¨æœŸ

##### 5.1 æ¦‚è¿°

çº¿ç¨‹ä»åˆ›å»ºåˆ°é”€æ¯ç»å†ä¸åŒé˜¶æ®µï¼Œç ”ç©¶çš„ç›®çš„æ˜¯åˆ†æä¸åŒé˜¶æ®µéœ€è¦åšä¸åŒçš„äº‹æƒ…ã€‚

##### 5.2 çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸäº”å¤§çŠ¶æ€

- **åˆ›å»º (NEW)**
  ```java
  Thread thread = new Thread();
  ```

- **å°±ç»ª (RUNNABLE)**
  ```java
  thread.start(); // çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…CPUè°ƒåº¦
  ```

- **è¿è¡Œ (RUNNING)**
  - è·å¾—æ‰§è¡Œæƒ
  - å¤±å»æ‰§è¡Œæƒï¼ˆè¢«æŠ¢èµ°ï¼‰â†’ å°±ç»ª

- **é˜»å¡ (BLOCKED/WAITING/TIMED_WAITING)**
  - **BLOCKED**ï¼šç­‰å¾…è¿›å…¥ synchronized ä»£ç å—/æ–¹æ³•
    - æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œä¸”è¯¥çº¿ç¨‹ç«äº‰åˆ°äº†é” â†’ å°±ç»ª
    
  - **WAITING**ï¼šæ— é™æœŸç­‰å¾…
  
    - å…¶ä»–çº¿ç¨‹ä½¿ç”¨`object.wait()`ç­‰å¾…`å½“å‰çº¿ç¨‹`
  
    - å…¶ä»–çº¿ç¨‹è°ƒç”¨ `object.notify()`/`notifyAll()`æ¢å¤å°±ç»ª
    - ç›®æ ‡çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼ˆå¯¹äºjoinæ— å‚æ–¹æ³•ï¼‰
  
  - **TIMED_WAITING**ï¼šæœ‰æ—¶é™çš„ç­‰å¾…
    
    - è°ƒç”¨äº†æŸäº›æ–¹æ³•ï¼š
      - `join(millis)`ï¼šæ’é˜Ÿ
      - `sleep(millis)`ï¼šä¼‘çœ 
      - `object.wait(timeout)`ï¼šç­‰å¾…
    - æŒ‡å®šçš„è¶…æ—¶æ—¶é—´åˆ°æœŸï¼Œæˆ–å…¶ä»–çº¿ç¨‹åœ¨è¶…æ—¶å‰å‘å‡ºäº†é€šçŸ¥
  
- **ç»ˆæ­¢ (TERMINATED)**
  - `run()` æ‰§è¡Œå®Œæ¯•
    - ä½¿ç”¨flagæ§åˆ¶
  - `run()` å‘ç”Ÿå¼‚å¸¸
    - `thread.interrupt()`

```java
public class ThreadLifecycleDemo {
    private static volatile boolean running = true;
    
    public static void main(String[] args) throws InterruptedException {
        Thread worker = new Thread(() -> {
            System.out.println("çº¿ç¨‹çŠ¶æ€: " + Thread.currentThread().getState()); // RUNNABLE
            
            while (running) {
                try {
                    Thread.sleep(1000); // TIMED_WAITING
                    System.out.println("å·¥ä½œä¸­...");
                } catch (InterruptedException e) {
                    System.out.println("çº¿ç¨‹è¢«ä¸­æ–­");
                    break;
                }
            }
            System.out.println("çº¿ç¨‹å³å°†ç»“æŸ");
        });
        
        System.out.println("åˆ›å»ºåçŠ¶æ€: " + worker.getState()); // NEW
        
        worker.start();
        System.out.println("å¯åŠ¨åçŠ¶æ€: " + worker.getState()); // RUNNABLE
        
        Thread.sleep(3000);
        
        // ä¼˜é›…åœæ­¢çº¿ç¨‹
        running = false;
        worker.join(); // ç­‰å¾…çº¿ç¨‹ç»“æŸ
        
        System.out.println("ç»“æŸåçŠ¶æ€: " + worker.getState()); // TERMINATED
    }
}
```

#### 6.çº¿ç¨‹åŒæ­¥

å¤šä¸ªçº¿ç¨‹æ“ä½œ`ä¸´ç•Œèµ„æº`çš„æ—¶å€™ï¼Œä¿è¯è¾¾åˆ°`æ•°æ®ä¸€è‡´æ€§`ï¼Œç§°ä¸º`çº¿ç¨‹åŒæ­¥`

- ä¸´ç•Œèµ„æºï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œçš„æ•°æ®ï¼Œç§°ä¸º`ä¸´ç•Œèµ„æº`ï¼Œåˆå«`å…±äº«èµ„æº`

- æ•°æ®ä¸ä¸€è‡´/çº¿ç¨‹ä¸åŒæ­¥çš„åŸå› ï¼šçº¿ç¨‹åœ¨æ“ä½œ`ä¸´ç•Œèµ„æº`çš„æ—¶å€™ï¼Œè¢«å…¶ä»–çº¿ç¨‹`æ‰“æ–­`

  ```java
  public class SimplestDemo {
      static int count = 0; // å…±äº«å˜é‡-ä¸´ç•Œèµ„æº
  
      public static void main(String[] args) throws InterruptedException {
          Runnable counter = () -> {
              for (int i = 0; i < 10000; i++) {
                  count++; // è¿™ä¸æ˜¯åŸå­æ“ä½œ
              }
          };
          // åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹countè‡ªå¢10000æ¬¡
          Thread t1 = new Thread(counter);
          Thread t2 = new Thread(counter);
  
          t1.start();
          t2.start();
  
          t1.join();
          t2.join();
  
          // ç»“æœåº”è¯¥ä¸º20000ï¼Œä½†å®é™…ä¼šå°äº20000
          System.out.println("æœ€ç»ˆç»“æœ: " + count);
          System.out.println("åº”è¯¥ä¸º: 20000");
      }
  }
  ```

##### 6.1 ä½¿ç”¨`synchronized`å…³é”®å­—

- ä¿®é¥°æ–¹æ³•

  ```java
  // synchronized æ–¹æ³•
  public static synchronized void increment() {
      count++;
  }
  //...
  Runnable counter = () -> {
      for (int i = 0; i < 10000; i++) {
          increment(); // è¿™ä¸æ˜¯åŸå­æ“ä½œ
      }
  };
      
  ```

- ä¿®é¥°ä»£ç å—ï¼ˆåŒæ­¥ä»£ç å—ï¼‰

  - `åŒæ­¥é”`ï¼šåŒæ­¥é”æ˜¯ä¸€ç§**äº’æ–¥æœºåˆ¶**ï¼Œå®ƒé€šè¿‡ä¿è¯`åŒä¸€æ—¶åˆ»`åªæœ‰`ä¸€ä¸ªçº¿ç¨‹`èƒ½å¤Ÿè®¿é—®ä¸´ç•Œèµ„æºæ¥å®ç°`çº¿ç¨‹åŒæ­¥`ã€‚

    - **åŒæ­¥æ˜¯ä¸€ç§æœºåˆ¶**ï¼šäº’æ–¥è®¿é—®ã€çº¿ç¨‹åŒæ­¥çš„æœºåˆ¶

    - **é”æ˜¯ä¸€ä¸ªå¯¹è±¡**ï¼šåœ¨Javaä¸­ï¼ŒåŒæ­¥æœºåˆ¶æ˜¯é€šè¿‡å¯¹è±¡çš„å†…ç½®é”ï¼ˆmonitor lockï¼‰æ¥å®ç°çš„

  ```java
  static final Object lock = new Object(); // é”å¯¹è±¡
  //...
  Runnable counter = () -> {
      for (int i = 0; i < 10000; i++) {
          synchronized (lock) {
              count++;
          }
      }
  };
  ```

##### 6.2 Lockæ¥å£

- `Lock`æ˜¯ä¸€ä¸ªæ¥å£ï¼Œ`ReentrantLock`æ˜¯å®ƒçš„`å”¯ä¸€`çš„`ç›´æ¥å®ç°ç±»`
- é€šè¿‡`lock`åŠ é”ï¼Œé€šè¿‡`unlock`è§£é”

```java
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

public class LockDemo {
    static int count = 0;
    static final Lock lock = new ReentrantLock(); // åˆ›å»ºLockå¯¹è±¡
    
    public static void main(String[] args) throws InterruptedException {
        Runnable counter = () -> {
            for (int i = 0; i < 10000; i++) {
                lock.lock();    // åŠ é”
                try {
                    count++;    // ä¸´ç•ŒåŒºæ“ä½œ
                } finally {
                    lock.unlock(); // è§£é”ï¼ˆç¡®ä¿ä¸€å®šä¼šæ‰§è¡Œï¼‰
                }
            }
        };
        Thread t1 = new Thread(counter);
        
        Thread t2 = new Thread(counter);
        
        t1.start();
        t2.start();
        
        t1.join();
        t2.join();
        
        System.out.println("æœ€ç»ˆç»“æœ: " + count); // ä¿è¯æ˜¯20000
    }
}
```

>##### **ğŸ”’ æ­»é” (Deadlock)**
>
>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› **äº‰å¤ºèµ„æº**è€Œé€ æˆçš„ä¸€ç§**äº’ç›¸ç­‰å¾…**çš„ç°è±¡ã€‚è‹¥æ— å¤–åŠ›å¹²æ¶‰ï¼Œè¿™äº›çº¿ç¨‹éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚
>
>- æ¡ä»¶`(ç¼ºä¸€ä¸å¯)`ï¼š
>
>  - **äº’æ–¥**ï¼šèµ„æºç‹¬å 
>  - **ä¸å¯æŠ¢å **ï¼šèµ„æºåªèƒ½ä¸»åŠ¨é‡Šæ”¾
>  - **è¯·æ±‚ä¸ä¿æŒ**ï¼šè¾¹æŒæœ‰è¾¹ç”³è¯·
>  - **å¾ªç¯ç­‰å¾…**ï¼šAç­‰Bï¼ŒBç­‰A
>
>  ```java
>  public class SimpleDeadlock {
>      private static final Object lock1 = new StringBuffer("lock1");
>      private static final Object lock2 = new StringBuffer("lock2");
>  
>      public static void main(String[] args) {
>          // ä½¿ç”¨lambdaè¡¨è¾¾å¼å’Œvarå…³é”®å­—
>          var thread1 = new Thread(() -> acquireLocks(lock1, lock2, "Thread1"));
>          var thread2 = new Thread(() -> acquireLocks(lock2, lock1, "Thread2"));
>  
>          thread1.start();
>          thread2.start();
>      }
>  
>      private static void acquireLocks(Object firstLock, Object secondLock, String threadName) {
>          synchronized (firstLock) {
>              System.out.println(threadName + " acquired "+ firstLock + " lock");
>              synchronized (secondLock) {
>                  System.out.println(threadName + " acquired " + firstLock + " lock");
>              }
>          }
>      }
>  }
>  // resultï¼š
>  // Thread2 acquired lock2 lock
>  // Thread1 acquired lock1 lock
>  ```
>
>- è§£å†³æ–¹æ¡ˆï¼š
>  - **é¡ºåºè·å–**ï¼šæ‰€æœ‰çº¿ç¨‹æŒ‰å›ºå®šé¡ºåºç”³è¯·é”
>  - **è¶…æ—¶æ”¾å¼ƒ**ï¼šä½¿ç”¨ `lock.tryLock(timeout)`ï¼Œå¤±è´¥åé‡Šæ”¾å·²æœ‰é”å¹¶é‡è¯•
>  - **ä¸€æ¬¡æ€§ç”³è¯·**ï¼šä½¿ç”¨ `Allocator` ç±»ç»Ÿä¸€ç”³è¯·æ‰€æœ‰æ‰€éœ€èµ„æº

#### 7.çº¿ç¨‹è®¾è®¡æ¨¡å¼

##### 7.1 å•ä¾‹æ¨¡å¼

ç¡®ä¿`ä¸€ä¸ªç±»`åªæœ‰`ä¸€ä¸ªå®ä¾‹`ï¼Œå¹¶æä¾›ä¸€ä¸ª`å…¨å±€è®¿é—®ç‚¹`ã€‚

- `ä¸å…è®¸å¤–ç•Œ`å®ä¾‹åŒ–å¯¹è±¡ï¼šæ„é€ æ–¹æ³•`ç§æœ‰åŒ–`
- å‘å¤–æä¾›`å”¯ä¸€æ¥å£(æ–¹æ³•)`ï¼Œè¿”å›`å¯¹è±¡å®ä¾‹`
- ä¿æŒå¯¹è±¡çš„`å”¯ä¸€æ€§`

```Mermaid
classDiagram
    class Singleton {
        -Singleton()
        -static instance: Singleton
        +static getInstance(): Singleton
    }
    Singleton o-- Singleton
```

- é¥¿æ±‰å¼ï¼ˆEager Initializationï¼‰`

  **ä¼˜ç‚¹ï¼š**

  - âœ… å®ç°ç®€å•ï¼Œä»£ç ç®€æ´
  - âœ… çº¿ç¨‹å®‰å…¨ï¼Œæ— éœ€åŒæ­¥
  - âœ… æ€§èƒ½å¥½ï¼Œæ— é”å¼€é”€

  **ç¼ºç‚¹ï¼š**

  - âŒ ç±»åŠ è½½æ—¶å°±åˆ›å»ºå®ä¾‹ï¼Œå¯èƒ½é€ æˆèµ„æºæµªè´¹
  - âŒ å¦‚æœå®ä¾‹å¾ˆå¤§ä¸”ä¸å¸¸ç”¨ï¼Œä¼šå ç”¨å†…å­˜
  - âŒ æ— æ³•å®ç°å»¶è¿ŸåŠ è½½

  ```java
  /* é¥¿æ±‰å¼ */
  public class EagerSingleton {
      // ç±»åŠ è½½æ—¶å°±åˆå§‹åŒ–å®ä¾‹
      private static final EagerSingleton INSTANCE = new EagerSingleton();
      
      // ç§æœ‰æ„é€ å‡½æ•°ï¼Œé˜²æ­¢å¤–éƒ¨å®ä¾‹åŒ–
      private EagerSingleton() {
          System.out.println("EagerSingleton instance created");
      }
      
      // æä¾›å…¨å±€è®¿é—®ç‚¹
      public static EagerSingleton getInstance() {
          return INSTANCE;
      }
      
      public void doSomething() {
          System.out.println("EagerSingleton is working");
      }
  }
  ```

- æ‡’æ±‰å¼ï¼ˆLazy Initializationï¼‰`

  **ä¼˜ç‚¹ï¼š**

  - âœ… å»¶è¿ŸåŠ è½½ï¼ŒèŠ‚çœå†…å­˜
  - âœ… åªæœ‰åœ¨éœ€è¦æ—¶æ‰åˆ›å»ºå®ä¾‹

  **ç¼ºç‚¹ï¼š**

  - âŒ åŒæ­¥æ–¹æ³•ç‰ˆæ€§èƒ½è¾ƒå·®ï¼ˆæ¯æ¬¡è·å–éƒ½è¦åŒæ­¥ï¼‰
  - âŒ æ£€æŸ¥é”å®šå®ç°è¾ƒå¤æ‚

  ```java
  /* æ‡’æ±‰å¼ï¼ˆåŒé‡æ£€æŸ¥ï¼‰ */
  public class DoubleCheckedSingleton {
      // ä½¿ç”¨volatileä¿è¯å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’åº
      private static volatile DoubleCheckedSingleton instance;
      
      private DoubleCheckedSingleton() {
          System.out.println("DoubleCheckedSingleton instance created");
      }
      
      public static DoubleCheckedSingleton getInstance() {
          if (instance == null) { // ç¬¬ä¸€æ¬¡æ£€æŸ¥
              synchronized (DoubleCheckedSingleton.class) {
                  if (instance == null) { // ç¬¬äºŒæ¬¡æ£€æŸ¥
                      instance = new DoubleCheckedSingleton();
                  }
              }
          }
          return instance;
      }
      
      public void doSomething() {
          System.out.println("DoubleCheckedSingleton is working");
      }
  }
  ```

> å…³äº`å•ä¾‹æ¨¡å¼`çš„`è¯¦è§£`ï¼Œç§»æ­¥åˆ°`DesignPatter/01-å•ä¾‹æ¨¡å¼.md`

##### 7.2 ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼

- ç®€å•æ¨¡å¼
  - ç”Ÿäº§è€…`(Producer)`ï¼šè´Ÿè´£ç”Ÿäº§æ•°æ®å¹¶å°†å…¶å‘é€åˆ°é˜Ÿåˆ—ï¼Œå¯ä»¥æœ‰å¤šä¸ªç”Ÿäº§è€…åŒæ—¶å·¥ä½œ
  - æ¶ˆè´¹è€…`(Consumer)`ï¼šä»é˜Ÿåˆ—ä¸­è·å–æ•°æ®å¹¶è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶å·¥ä½œ
  - é˜Ÿåˆ—`(Queue)`ï¼šç”¨äºå­˜å‚¨æ•°æ®çš„ç¼“å†²åŒºï¼Œç”Ÿäº§è€…å°†æ•°æ®æ”¾å…¥é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­è·å–æ•°æ®
    - åŒ…å«å±æ€§
      - å®¹é‡é™åˆ¶ï¼šå¯æ»¡å¯ç©º
      - ç©º/æ»¡çŠ¶æ€æ ‡å¿—
      - å…ƒç´ æ•°é‡
  - æ•°æ®`(Data)`ï¼šç”Ÿäº§è€…ç”Ÿäº§çš„æ•°æ®ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹çš„æ•°æ®
  - åŒæ­¥æœºåˆ¶ï¼šç¡®ä¿ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…åœ¨è®¿é—®é˜Ÿåˆ—æ—¶çš„`çº¿ç¨‹å®‰å…¨`ï¼Œé¿å…æ•°æ®ç«äº‰å’Œä¸ä¸€è‡´æ€§
  
  ```java
  import java.util.LinkedList;
  import java.util.function.Consumer;
  import java.util.function.Supplier;
  
  public class FunctionalPC {
      private static final LinkedList<Integer> queue = new LinkedList<>();
      private static final int CAPACITY = 3;
      private static int count = 0;
      
      public static void main(String[] args) {
          // ç”Ÿäº§è€…å‡½æ•°
          Supplier<Integer> producer = () -> {
              synchronized (queue) {
                  while (queue.size() == CAPACITY) {
                      try { queue.wait(); } catch (InterruptedException e) {}
                  }
                  int product = ++count;
                  queue.add(product);
                  System.out.println("ç”Ÿäº§: " + product + "ï¼Œé˜Ÿåˆ—: " + queue.size());
                  queue.notifyAll();
                  return product;
              }
          };
          
          // æ¶ˆè´¹è€…å‡½æ•°
          Consumer<Integer> consumer = (product) -> {
              synchronized (queue) {
                  while (queue.isEmpty()) {
                      try { queue.wait(); } catch (InterruptedException e) {}
                  }
                  int consumed = queue.removeFirst();
                  System.out.println("æ¶ˆè´¹: " + consumed + "ï¼Œé˜Ÿåˆ—: " + queue.size());
                  queue.notifyAll();
              }
          };
          
          // å¯åŠ¨ç”Ÿäº§è€…çº¿ç¨‹
          new Thread(() -> {
              while (true) {
                  Integer product = producer.get();
                  try { Thread.sleep(300); } catch (InterruptedException e) {}
              }
          }).start();
          
          // å¯åŠ¨æ¶ˆè´¹è€…çº¿ç¨‹
          new Thread(() -> {
              while (true) {
                  consumer.accept(null);
                  try { Thread.sleep(500); } catch (InterruptedException e) {}
              }
          }).start();
      }
  }
  ```
  
- å¤æ‚æ¨¡å¼ï¼šå‚è€ƒ`DesignPatter/30-ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼.md`

> å…³äº`ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼`çš„`è¯¦è§£`ï¼Œç§»æ­¥åˆ°`DesignPatter/30-ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼.md`

#### 8.ThreadLocalç±»

`ThreadLocal`æ˜¯ Java ä¸­ç”¨äº`åˆ›å»ºçº¿ç¨‹å±€éƒ¨å˜é‡`çš„ç±»ã€‚`æ¯ä¸ªçº¿ç¨‹`éƒ½æœ‰è‡ªå·±`ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬`ï¼Œ`äº’ä¸å¹²æ‰°`ã€‚ä»¥å®ç°`çº¿ç¨‹åŒæ­¥å¤„ç†`ä¸´ç•Œèµ„æºï¼Œ`ä¿è¯æ•°æ®ä¸€è‡´æ€§`

- set(T value)ï¼šè®¾ç½®å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡
- T get()ï¼šè·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡
- T remove()ï¼šç§»é™¤å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡

```java
public class TinyThreadLocalDemo {
    private static ThreadLocal<String> tl = new ThreadLocal<>();

    public static void main(String[] args) {
        new Thread(() -> {
            tl.set("çº¿ç¨‹Aæ•°æ®");
            System.out.println("A:get=" + tl.get());
            tl.remove();
            System.out.println("A:removeå=" + tl.get());
        }).start();

        new Thread(() -> {
            tl.set("çº¿ç¨‹Bæ•°æ®");
            System.out.println("B:get=" + tl.get());
            tl.remove();
            System.out.println("B:removeå=" + tl.get());
        }).start();
    }
}
```

#### 9.å®ˆæŠ¤çº¿ç¨‹

`å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Thread`ï¼‰æ˜¯ Java ä¸­ä¸€ç§`ç‰¹æ®Šçš„çº¿ç¨‹ç±»å‹`ï¼Œ

- æœ¬è´¨æ˜¯ä¸ºå…¶ä»–çº¿ç¨‹ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼‰æä¾›æœåŠ¡
- ä½¿ç”¨`setDaemon(true)`å°†çº¿ç¨‹å®šä¹‰ä¸º`å®ˆæŠ¤çº¿ç¨‹`ï¼Œä½¿ç”¨`isDaemon()`åˆ¤æ–­æ˜¯å¦ä¸º`å®ˆæŠ¤çº¿ç¨‹`

- ä¼´éšä¸»çº¿ç¨‹è€Œç”Ÿï¼Œéšä¸»çº¿ç¨‹ç»“æŸè€Œæ¶ˆäº¡
- ä½¿ç”¨åœºæ™¯
  - åƒåœ¾å›æ”¶
  - å®šæ—¶ä»»åŠ¡ï¼šæ•°æ®å¤‡ä»½
  - æœåŠ¡å™¨ç›‘æ§

```java
public class DaemonDemo {
    public static void main(String[] args) throws InterruptedException {
        // åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹
        Thread daemon = new Thread(() -> {
            while (true) { // æ— é™å¾ªç¯ï¼Œæ¨¡æ‹ŸæŒç»­è¿è¡Œ
                System.out.println("å®ˆæŠ¤çº¿ç¨‹è¿è¡Œä¸­...");
                try { Thread.sleep(500); } 
                catch (InterruptedException e) {}
            }
        });
        
        daemon.setDaemon(true); // æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹
        daemon.start();         // å¯åŠ¨
        
        // ä¸»çº¿ç¨‹ï¼ˆç”¨æˆ·çº¿ç¨‹ï¼‰è¿è¡Œ1ç§’åç»“æŸ
        Thread.sleep(1000);
        System.out.println("ä¸»çº¿ç¨‹ç»“æŸï¼Œå®ˆæŠ¤çº¿ç¨‹å°†è¢«å¼ºåˆ¶ç»ˆæ­¢");
    }
}
```

#### 10. çº¿ç¨‹æ± 

##### 10.1 ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± 

- çº¿ç¨‹æ± æ˜¯ä¸€ç§**çº¿ç¨‹ç®¡ç†æœºåˆ¶**ï¼Œé¢„å…ˆåˆ›å»ºä¸€å®šæ•°é‡çš„çº¿ç¨‹å¹¶æ”¾å…¥ "æ± " ä¸­ç»Ÿä¸€ç®¡ç†ã€‚
- ä»»åŠ¡æ‰§è¡Œæ—¶ä»æ± ä¸­è·å–çº¿ç¨‹ï¼Œå®Œæˆåçº¿ç¨‹è¿”å›æ± ä¸­ç­‰å¾…ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯çº¿ç¨‹ã€‚
- æ ¸å¿ƒæ˜¯**å¤ç”¨çº¿ç¨‹èµ„æº**ï¼Œé™ä½æ€§èƒ½å¼€é”€ã€‚

##### 10.2 çº¿ç¨‹æ± çš„ä½œç”¨

- é™ä½èµ„æºæ¶ˆè€—ï¼šå‡å°‘çº¿ç¨‹åˆ›å»º / é”€æ¯çš„ CPU å’Œå†…å­˜å¼€é”€ã€‚
- æé«˜å“åº”é€Ÿåº¦ï¼šä»»åŠ¡åˆ°è¾¾æ—¶æ— éœ€ç­‰å¾…çº¿ç¨‹åˆ›å»ºï¼Œç›´æ¥ä½¿ç”¨ç©ºé—²çº¿ç¨‹ã€‚
- ä¾¿äºç®¡ç†ï¼šç»Ÿä¸€æ§åˆ¶çº¿ç¨‹æ•°é‡ã€ä»»åŠ¡é˜Ÿåˆ—å¤§å°ï¼Œé˜²æ­¢èµ„æºè€—å°½ã€‚
- é™„åŠ åŠŸèƒ½ï¼šæ”¯æŒå®šæ—¶æ‰§è¡Œã€å®šæœŸæ‰§è¡Œã€çº¿ç¨‹ä¸­æ–­æ§åˆ¶ç­‰ã€‚

##### 10.3 æ ¸å¿ƒå‚æ•°

- æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆcorePoolSizeï¼‰ï¼šçº¿ç¨‹æ± é•¿æœŸç»´æŒçš„çº¿ç¨‹æ•°é‡
- æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSizeï¼‰ï¼šå…è®¸åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°é‡
- ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼ˆkeepAliveTimeï¼‰ï¼šéæ ¸å¿ƒçº¿ç¨‹ç©ºé—²è¶…æ—¶æ—¶é—´
- æ—¶é—´å•ä½ï¼ˆunitï¼‰ï¼škeepAliveTime çš„æ—¶é—´å•ä½
- å·¥ä½œé˜Ÿåˆ—ï¼ˆworkQueueï¼‰ï¼šå­˜æ”¾ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—
- çº¿ç¨‹å·¥å‚ï¼ˆthreadFactoryï¼‰ï¼šç”¨äºåˆ›å»ºçº¿ç¨‹çš„å·¥å‚
- æ‹’ç»ç­–ç•¥ï¼ˆhandlerï¼‰ï¼šä»»åŠ¡æ»¡æ—¶çš„å¤„ç†ç­–ç•¥

##### 10.4 å·¥ä½œæœºåˆ¶

- å½“æ–°ä»»åŠ¡æäº¤æ—¶ï¼Œè‹¥å½“å‰çº¿ç¨‹æ•° < æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡
- è‹¥å½“å‰çº¿ç¨‹æ•° â‰¥ æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå°†ä»»åŠ¡æ”¾å…¥å·¥ä½œé˜Ÿåˆ—ç­‰å¾…
- è‹¥é˜Ÿåˆ—å·²æ»¡ï¼Œä¸”å½“å‰çº¿ç¨‹æ•° < æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡
- è‹¥é˜Ÿåˆ—å·²æ»¡ä¸”çº¿ç¨‹æ•°å·²è¾¾æœ€å¤§çº¿ç¨‹æ•°ï¼Œè§¦å‘æ‹’ç»ç­–ç•¥

##### 10.5 å¸¸ç”¨çº¿ç¨‹æ± 

 | çº¿ç¨‹æ± åç§°                    | æè¿°                                        |
  | ----------------------------- | ------------------------------------------- |
  | FixedThreadPool               | æ ¸å¿ƒçº¿ç¨‹æ•°ä¸æœ€å¤§çº¿ç¨‹æ•°ç›¸åŒ                  |
  | SingleThreadExecutor          | ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ±                             |
  | CachedThreadPool              | æ ¸å¿ƒçº¿ç¨‹ä¸º0ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸ºInteger. MAX_VALUE |
  | ScheduledThreadPool           | æŒ‡å®šæ ¸å¿ƒçº¿ç¨‹æ•°çš„å®šæ—¶çº¿ç¨‹æ±                   |
  | SingleThreadScheduledExecutor | å•ä¾‹çš„å®šæ—¶çº¿ç¨‹æ±                             |
  | ForkJoinPool                  | å¤„ç†å¯åˆ†è§£çš„å¤§ä»»åŠ¡ï¼Œé‡‡ç”¨å·¥ä½œçªƒå–ç®—æ³•        |

```java
// 1. FixedThreadPool - å›ºå®šçº¿ç¨‹æ•°çš„CPUå¯†é›†å‹ä»»åŠ¡
ExecutorService fixedPool = Executors.newFixedThreadPool(4);
fixedPool.submit(() -> System.out.println("FixedThreadPool task running on: " + Thread.currentThread().getName()));
fixedPool.shutdown();

// 2. SingleThreadExecutor - éœ€è¦é¡ºåºæ‰§è¡Œçš„ä»»åŠ¡
ExecutorService singleThreadPool = Executors.newSingleThreadExecutor();
IntStream.range(0, 3).forEach(i -> 
    singleThreadPool.submit(() -> System.out.println("Task " + i + " executed by SingleThreadPool")));
singleThreadPool.shutdown();

// 3. CachedThreadPool - å¤§é‡çŸ­ç”Ÿå‘½å‘¨æœŸå¼‚æ­¥ä»»åŠ¡
ExecutorService cachedPool = Executors.newCachedThreadPool();
IntStream.range(0, 10).forEach(i ->
    cachedPool.submit(() -> System.out.println("CachedThreadPool task: " + i)));
cachedPool.shutdown();

// 4. ScheduledThreadPool - å®šæ—¶å‘¨æœŸæ€§ä»»åŠ¡
ScheduledExecutorService scheduledPool = Executors.newScheduledThreadPool(2);
scheduledPool.scheduleAtFixedRate(() -> 
    System.out.println("Scheduled task running at: " + new Date()), 1, 2, TimeUnit.SECONDS);
Thread.sleep(5000);
scheduledPool.shutdown();

// 5. SingleThreadScheduledExecutor - å•çº¿ç¨‹å®šæ—¶ä»»åŠ¡
ScheduledExecutorService singleScheduled = Executors.newSingleThreadScheduledExecutor();
singleScheduled.schedule(() -> 
    System.out.println("Single scheduled task executed after delay"), 1, TimeUnit.SECONDS);
Thread.sleep(2000);
singleScheduled.shutdown();

// 6. ForkJoinPool - åˆ†æ²»é€’å½’ä»»åŠ¡
ForkJoinPool forkJoinPool = new ForkJoinPool();
forkJoinPool.submit(() -> {
    IntStream.range(0, 4).parallel().forEach(i -> 
        System.out.println("ForkJoin task " + i + " executed by " + Thread.currentThread().getName()));
}).join();
forkJoinPool.shutdown();
```









