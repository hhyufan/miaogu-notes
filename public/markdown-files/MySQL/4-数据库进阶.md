# 数据库进阶

## 三大范式

### 第一范式（1NF）
- 表中的数据应该具有原子性
- 每个字段都是不可分割的基本数据项

### 第二范式（2NF）
- 表中所有非主属性要和主键相关联
- 消除部分函数依赖

### 第三范式（3NF）
- 表之间如果存在关系，需要通过外键约束
- 消除传递函数依赖

## 视图

### 子表的缺点
- 子表占据额外的数据存储空间，造成资源浪费
- 子表和主表的数据同步问题

### 视图的特点
- 视图是虚表，实际为某表的查询语句
- 视图的数据和主表数据同步

### 视图的创建
```sql
CREATE VIEW view_name AS (SELECT 语句)
```

### 视图的操作
- 视图的相关操作和表一致

## 索引

### 索引概述
- 索引index，对数据库多列进行排序结构，属于DDL语言
- 类似于字典的目录，提高数据查询效率

### 优缺点
#### 优点
- 提高查询效率

#### 缺点
- 额外的占用存储空间
- 添加、修改、删除耗时长

### 索引类型
- 主键索引
- 唯一性索引
- 普通索引
- 联合索引

### 索引的操作
#### 1. 创建
```sql
CREATE INDEX 索引名字 ON 表名(列名, 列名)
```

#### 2. 查询
```sql
SHOW INDEX FROM 表名
```

#### 3. 删除
```sql
DROP INDEX 索引名 ON 表名
```

### 数据结构
- 数据结构：B+树
- MYSQL所有数据都存储在根节点中

### 聚簇索引与非聚簇索引
#### 聚簇索引
- 称为主键索引
- 每个表聚簇索引只有一个，对应主键索引

#### 非聚簇索引/辅助索引
- 非主键索引统称为辅助索引
- 通过非聚簇索引寻找主键索引，然后根据主键索引查询具体字段（回表查询）

### 哪些列加索引
- WHERE
- ORDER BY
- GROUP BY
- JOIN ..... ON

## 事务

### 事务概述
- Transaction 事务，一组保持数据状态一致性的统一操作，或者统一成功，或失败
- TCL（Transition Control Language）事务控制语言

### 四大特性（ACID）
- **原子性（Atomicity）**：事务是一个不可分割的工作单位
- **一致性（Consistency）**：事务必须使数据库从一个一致性状态变换到另一个一致性状态
- **隔离性（Isolation）**：一个事务的执行不能被其他事务干扰
- **持久性（Durability）**：一个事务一旦被提交，它对数据库中数据的改变就是永久性的

### 事务操作
#### 开启
```sql
START TRANSACTION | BEGIN
```
- 如果未开启事务，所有操作都是独立的，执行完毕自动提交#持久化保存下来

#### 提交
```sql
COMMIT
```
- 如果提交，数据持久化保存，事务结束

#### 回滚
```sql
ROLLBACK
```
- 将数据状态回滚到上一次提交的状态

### 事务并发可能存在的问题
- 脏读（Dirty Read）
- 不可重复读（Non-repeatable Read）
- 幻读（Phantom Read）

### 事务隔离级别
- **READ UNCOMMITTED（读未提交）**：最低的隔离级别，允许读取尚未提交的数据变更
- **READ COMMITTED（读已提交）**：允许读取并发事务已经提交的数据
- **REPEATABLE READ（可重复读）**：对同一字段的多次读取结果都是一致的
- **SERIALIZABLE（可串行化）**：最高的隔离级别，完全服从ACID的隔离级别