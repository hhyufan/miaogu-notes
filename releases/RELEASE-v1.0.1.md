# MGTree Editor v1.0.1 🚀

[![release](https://img.shields.io/badge/release-v1.0.1-orange)](https://github.com/hhyufan/miaogu-ide) [![date](https://img.shields.io/badge/date-2025--01--26-blue)](https://github.com/hhyufan/miaogu-ide)

## 🎯 功能增强版本

本版本专注于用户体验优化和数据安全性提升，引入了三个重要的新功能特性。

## ✨ 新增功能

### 🔄 **自动保存机制**

- **智能自动保存**：重构删除节点修复逻辑，实现智能自动保存机制
- **防数据丢失**：编辑操作自动触发保存，有效防止意外数据丢失
- **无感知保存**：后台自动保存，不影响用户编辑体验
- **状态同步**：确保界面状态与文件内容实时同步

### 🔗 **数据双向实时同步**

- **外部文件监听**：自动检测外部文件修改，实时同步到编辑器
- **双向数据流**：支持编辑器内修改和外部文件修改的双向同步
- **冲突处理**：智能处理文件冲突，确保数据一致性
- **实时刷新**：外部修改后自动刷新编辑器内容，无需手动重新加载

### 📁 **新文件折叠状态优化**

- **默认折叠**：新打开的文件默认为全折叠状态，提供清晰的初始视图
- **智能展开**：区分新文件打开和应用重启的状态恢复逻辑
- **状态记忆**：应用重启后正确恢复之前的展开/折叠状态
- **用户友好**：通过面包屑导航或"打开文件"按钮打开的新文件自动折叠

## 🔧 技术改进

### 📊 **状态管理优化**

- **增强状态持久化**：改进 `stateManager.js`，新增 `saveCurrentFile` 和 `loadCurrentFile` 方法
- **智能状态恢复**：优化应用启动时的状态恢复逻辑，确保正确恢复之前的工作状态
- **性能提升**：使用防抖机制优化状态保存频率，减少不必要的磁盘写入

### 🎛️ **文件监听系统**

- **原生文件监听**：基于 Node.js `fs.watchFile` 实现高效的文件变化监听
- **智能过滤**：只监听 `.mgtree` 文件，避免不必要的资源消耗
- **错误处理**：完善的错误处理机制，确保文件监听的稳定性

### 🔄 **组件逻辑重构**

- **TreeEditor 组件优化**：重构文件加载逻辑，区分不同场景的状态处理
- **生命周期管理**：优化 React 组件的生命周期管理，提升性能和稳定性
- **代码结构改进**：提升代码可读性和维护性

## 🐛 问题修复

- **修复**：应用重启后无法恢复展开/折叠状态的问题
- **修复**：外部文件修改后编辑器不同步的问题
- **修复**：删除节点后状态不一致的问题
- **修复**：新文件打开时状态恢复错误的问题

## 📋 完整更新日志

### 新增 (Added)
- 自动保存机制，重构删除节点修复逻辑
- 外部文件修改的实时同步功能
- 文件监听系统，支持 `.mgtree` 文件变化检测
- 新文件打开时的默认折叠状态
- `stateManager.js` 中的 `saveCurrentFile` 和 `loadCurrentFile` 方法

### 改进 (Changed)
- 优化状态管理逻辑，区分文件切换和应用重启场景
- 改进 TreeEditor 组件的初始化逻辑
- 提升文件加载和状态恢复的性能

### 修复 (Fixed)
- 应用重启后展开/折叠状态丢失问题
- 外部文件修改后编辑器不同步问题
- 删除节点后数据不一致问题
- 新文件打开时状态恢复错误问题

## 🔄 升级指南

从 v1.0.0 升级到 v1.0.1：

1. **自动升级**：应用会自动检测并应用新功能
2. **状态迁移**：现有的用户状态和设置将自动迁移
3. **兼容性**：完全向后兼容，无需修改现有的 `.mgtree` 文件

## 🎯 下一步计划

- 增强文件导入/导出功能
- 支持更多文件格式的跳转语法
- 添加协作编辑功能
- 性能进一步优化

## 🙏 致谢

感谢所有用户的反馈和建议，帮助我们不断改进 MGTree Editor。

---

**下载地址**：[GitHub Releases](https://github.com/hhyufan/miaogu-ide/releases/tag/v1.0.1)

**问题反馈**：[GitHub Issues](https://github.com/hhyufan/miaogu-ide/issues)

**更新时间**：2025年1月26日